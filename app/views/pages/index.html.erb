<script>
  var mapAccessKey = "<%= ENV['MAP_ACCESS_KEY'] %>";
  // export MAP_ACCESS_KEY= in bash session & will need to enter into Heroku when deployed
</script>


<div id="tripform">
<input id="placefinder"/><input type="text" id="datepicker" placeholder="Date" />
<button id ="addplace">+</button>
</div>

<div id="map">
  
</div>

<script>
// Map display
$(document).ready(function() {
  L.mapbox.accessToken = mapAccessKey;
// Create a map in the div #map
  L.mapbox.map('map', 'mapbox.streets').setView([0, 0], 2);
  console.log(geojson);
  var myLayer = L.mapbox.featureLayer().addTo(map);
  myLayer.setGeoJSON(geojson);
});

//date picker widget
$(function() {
  $("#datepicker").datepicker({
  dateFormat: "dd-mm-yy",
  changeMonth: true,
  changeYear: true
  })
});

//autocomplete place names
var options = {
  url: function(input) { 
    return "https://api.mapbox.com/geocoding/v5/mapbox.places/" + input + 
    ".json?types=place%2Ccountry%2Cregion&access_token=" + mapAccessKey;
  },

  getValue: "place_name",

  ajaxSettings: {
      dataType: "json"
  },

  listLocation: "features",

  requestDelay: 300,

  theme: "round",

  placeholder: "Enter a place",

  list: {
    onChooseEvent: function() {
      var coords = $('#placefinder').getSelectedItemData().center;
      var placeName = $('#placefinder').getSelectedItemData().place_name;
    }
  }
};

$("#placefinder").easyAutocomplete(options);


$('#addplace').on('click', function(event) {
  var $newPlace = $('<p>').text($('#placefinder').val());
  var $newDate = $('<span>').text(' ' + $('#datepicker').val());
  $newPlace.append($newDate);
  $('#tripform').append($newPlace);
})

var geojson = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -77.0366048812866,
          38.89784666877921
        ]
      },
      "properties": {}
    }
  ]
}

</script>

